#!/usr/bin/env bash

# make links from dotfiles/*/*.symlink into home dir

# use this command to find and delete old symlinks first
# find "$HOME" -type l -maxdepth 1 -delete

# i.e. after this, `ls -la` from the home dir will look like:
# ~/.vimrc -> ~/dotfiles/editors/vimrc.symlink
# ~/.zshrc -> ~/dotfiles/shell/zshrc.symlink

set -o errexit

cd "$(dirname "$0")/.."
DOTFILES_ROOT=$(pwd -P)

install_dotfiles () {
    printf 'installing dotfiles'

    while IFS= read -r -d '' src
    do
        dest="$HOME/.$(basename "${src%.*}")"
        printf "\nlinking %s to %s - \n" "$src" "$dest"
        if [[ -L "$dest" && -e "$dest" ]]
        then
            echo "removing old symlink $dest"
            rm $dest
        fi
        ln -s "$src" "$dest" && printf "ok"
    done <   <(find -H "$DOTFILES_ROOT" -maxdepth 2 -name '*.symlink' -not -path '*.git*' -print0)
    printf '\ndone'
}

install_dotfiles

